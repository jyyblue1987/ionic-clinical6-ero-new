{"version":3,"sources":["../src/@ionic-clinical6/core/pages/sign-up/login-verify-code.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AACtD,OAAO,EAAE,aAAa,EAAE,SAAS,EAAE,eAAe,EAAY,iBAAiB,EAAE,eAAe,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAClI,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAE7C,OAAO,EAAe,SAAS,EAAE,WAAW,EAAE,MAAM,WAAW,CAAC;AAEhE,OAAO,EAAE,iBAAiB,EAAE,MAAM,qCAAqC,CAAC;AAExE,OAAO,EAAE,gBAAgB,EAAE,MAAM,yBAAyB,CAAC;AAC3D,OAAO,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAClD,OAAO,EAAyB,iBAAiB,EAAU,MAAM,WAAW,CAAC;AAC7E,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AAmCtD,IAAa,cAAc,GAA3B,oBAA4B,SAAQ,QAAQ;IAa1C,YACS,iBAAoC,EACpC,QAAyB,EACzB,UAA6B,EAC7B,QAAkB,EAClB,UAAsB,EACtB,YAA8B,EAC9B,SAA0B,EAC1B,SAA0B,EAC1B,MAAiB,EACjB,GAAkB,EAClB,QAAkB;QAEzB,KAAK,CAAC,QAAQ,EACZ,UAAU,CAAC,CAAC;QAbP,sBAAiB,GAAjB,iBAAiB,CAAmB;QACpC,aAAQ,GAAR,QAAQ,CAAiB;QACzB,eAAU,GAAV,UAAU,CAAmB;QAC7B,aAAQ,GAAR,QAAQ,CAAU;QAClB,eAAU,GAAV,UAAU,CAAY;QACtB,iBAAY,GAAZ,YAAY,CAAkB;QAC9B,cAAS,GAAT,SAAS,CAAiB;QAC1B,cAAS,GAAT,SAAS,CAAiB;QAC1B,WAAM,GAAN,MAAM,CAAW;QACjB,QAAG,GAAH,GAAG,CAAe;QAClB,aAAQ,GAAR,QAAQ,CAAU;QAtB3B,iBAAY,GAAY,KAAK,CAAC;QAE9B,oBAAe,GAAG,CAAC,CAAC;QAEpB,WAAM,GAAW,EAAE,CAAC;QACpB,aAAQ,GAAW,EAAE,CAAC;QAEtB,kBAAa,GAAG,KAAK,CAAC;QACtB,qBAAgB,GAAG,KAAK,CAAC;IAkBzB,CAAC;IACD,QAAQ;QACN,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;YACxC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YACpD,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;QACD,IAAI;YACF,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAE1B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAEzC,CAAC;IACD,cAAc;QACZ,qCAAqC;IACvC,CAAC;IAEK,YAAY;;YAChB,IAAI,OAAO,GAAG,IAAI,CAAC;YACnB,IAAI,KAAK,CAAC;YACV,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBACvB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC;gBAC9C,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACtB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBACzB,IAAI,CAAC;oBACH,IAAI,OAAO,GAAG,MAAM,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,CAAC,MAAM,EAAE,CAAC,CAAA;oBAClI,uBAAuB;oBACvB,gCAAgC;oBAChC,SAAS,CAAC,IAAI,GAAG,OAAO,CAAC;oBACzB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;oBAC1B,+CAA+C;oBAC/C,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC7E,YAAY,CAAC,OAAO,CAAC,iBAAiB,EAAE,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;oBAEtE,kGAAkG;oBAClG,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;oBACnD,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAA;oBAErB,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAC7B,CAAC;gBAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;oBACb,WAAW,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC;oBAC9B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;oBAC1B,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;oBAElD,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAA;oBAErB,EAAE,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;wBAClD,0CAA0C;wBAC1C,IAAI,CAAC,mBAAmB,EAAE,CAAC;wBAC3B,MAAM,CAAC;oBACT,CAAC;oBAED,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAE;wBAC7B,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,yBAAyB,CAAC,IAAI,OAAO;wBACzE,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,2BAA2B,CAAC,IAAI,wCAAwC;wBACrG,QAAQ,EAAE,YAAY;wBACtB,OAAO,EAAE;4BACP;gCACI,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,IAAI;gCACtD,OAAO,EAAE,IAAI;oCACX,KAAK,CAAC,OAAO,EAAE,CAAC;gCAClB,CAAC;6BACF;yBACF;qBACF,CAAC,CAAC;oBACH,KAAK,CAAC,OAAO,EAAE,CAAC;gBACpB,CAAC;YACH,CAAC;QACH,CAAC;KAAA;IACD;;;OAGG;IACH,mBAAmB;IAEnB,CAAC;IAED,WAAW;QACT,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;IAED,gBAAgB;QAEd,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACvB,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,IAAI,CAAC,eAAe,CAAC,CAAC;QACzD,CAAC;QACD,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IAED,SAAS,CAAC,KAAU;QAClB,0BAA0B;QAC1B,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,IAAI,CAAC,eAAe,CAAC;YAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;IAC9E,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;QACf,YAAY,CAAC,KAAK,EAAE,CAAC;IACvB,CAAC;IACD,0BAA0B;IAC1B,+CAA+C;IAC/C,gBAAgB;IAChB,IAAI;IACJ,+BAA+B;IAC/B,wDAAwD;IACxD,gBAAgB;IAChB,IAAI;IACJ,gBAAgB;QACd,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,yBAAyB,CAAC,IAAI,mBAAmB;YACrF,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,2BAA2B,CAAC,IAAI,8BAA8B;YAC3F,QAAQ,EAAE,YAAY;YACtB,OAAO,EAAE;gBACP;oBACE,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,IAAI;oBACtD,OAAO,EAAE,IAAI;oBACb,CAAC;iBACF;aACF;SACF,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC;CACF,CAAA;AAtJY,cAAc;IAjC1B,SAAS,CAAC;QACT,QAAQ,EAAE,mBAAmB;QAC7B,QAAQ,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6BT;KACF,CAAC;qCAe4B,iBAAiB;QAC1B,eAAe;QACb,iBAAiB;QACnB,QAAQ;QACN,UAAU;QACR,gBAAgB;QACnB,eAAe;QACf,eAAe;QAClB,SAAS;QACZ,aAAa;QACR,QAAQ;GAxBhB,cAAc,CAsJ1B;SAtJY,cAAc","file":"login-verify-code.js","sourcesContent":["import { ElementRef, Component } from '@angular/core';\nimport { NavController, NavParams, ModalController,  Loading, LoadingController, AlertController, Platform } from 'ionic-angular';\nimport { BasePage } from '../base/base-page';\n\nimport { flowService, clinical6, userService } from 'clinical6';\nimport { Flows } from '../../flow_process/flow-factory';\nimport { TranslatorService } from '../../translator/translator.service';\n\nimport { Clinical6Service } from '../../clinical6.service';\nimport { Keyboard } from '@ionic-native/keyboard';\nimport { Device, deviceService, mobileUserService, Client } from 'clinical6';\nimport { AppLoginService } from '../../login.service';\n\n@Component({\n  selector: 'login-verify-code',\n  templateUrl: 'login-verify-code.html'\n})\nexport class VerifyCodePage extends BasePage {\n\n  isNavigating: boolean = false;\n\n  PIN_CODE_DIGITS = 6;\n\n  userId: string = '';\n  userCode: string = '';\n\n  doValidatePIN = false;\n  needConfirmation = false;\n  loader: Loading;\n  \n  constructor(\n    public loadingController: LoadingController,    \n    public loginSvc: AppLoginService,\n    public translator: TranslatorService,\n    public platform: Platform,\n    public elementRef: ElementRef,\n    public c6LibService: Clinical6Service,\n    public alertCtrl: AlertController,\n    public modalCtrl: ModalController,\n    public params: NavParams,\n    public nav: NavController,\n    public keyboard: Keyboard) {\n\n    super(platform,\n      elementRef);\n  }\n  ngOnInit() {\n    if (this.params.get('invitation_token')) {\n      this.userCode = this.params.get('invitation_token');\n      this.doneCallback();\n    }\n    else\n      this.showWelcomeAlert();\n\n    this.userId = this.params.get('email');\n\n  }\n  ionViewDidLoad() {\n    // overwriting the super class method\n  }\n\n  async doneCallback() {\n    var thisRef = this;\n    let alert;\n    if (!this.isNavigating) {\n      this.loader = this.loadingController.create();\n      this.loader.present();\n      this.isNavigating = true;\n      try {\n        let newUser = await mobileUserService.acceptInvitation(this.userCode.toString(), { email: this.userId, device: clinical6.device })      \n        // .then((newUser) => {\n        //userService['type'] = 'users';\n        clinical6.user = newUser;\n        this.isNavigating = false;\n        // storing the current user on the localStorage\n        localStorage.setItem('currentUser', JSON.stringify(clinical6.user.toJSON()));\n        localStorage.setItem('confirmedUserID', clinical6.user.id.toString());\n\n        // storing the current token, which could be used later on during a mobile_user invitation pro ess\n        this.loginSvc.currToken = this.userCode.toString();\n        this.loader.dismiss()\n        \n        this.confirmationSuccess();\n      } catch (err) {\n        userService['type'] = 'users';\n        this.isNavigating = false;\n        console.error('Unable to Accept invitation', err);\n\n        this.loader.dismiss()\n        \n        if (err.message.indexOf('already confirmed') > -1) {\n          // email  already confirmed, move to login\n          this.confirmationSuccess();\n          return;\n        }\n        \n        alert = this.alertCtrl.create ({\n          title: this.translator.getInnerHTML('VERIFY_CODE_ERROR_TITLE') || 'Error',\n          message: this.translator.get('VERIFY_CODE_ERROR_MESSAGE') || 'Please Verify Your Code and try again.',\n          cssClass: 'code-alert',\n          buttons: [\n            {\n                text: this.translator.getInnerHTML('POPUP_OK') || 'OK',\n                handler: data => {\n                  alert.dismiss();\n                }\n              }\n            ]\n          });\n          alert.present();\n      }\n    }\n  }\n  /**\n   * This is to be overridden by derived classes\n   * put all code in case of confirmation success here\n   */\n  confirmationSuccess() {\n\n  }\n\n  canContinue() {\n    return true;\n  }\n\n  validateAlertPIN() {\n\n    if (this.doValidatePIN) {\n      return (this.userCode.length !== this.PIN_CODE_DIGITS);\n    }\n    else {\n      return false;\n    }\n  }\n\n  handleKey(event: any) {\n    // super.handleKey(event);\n    if (this.userCode.length >= this.PIN_CODE_DIGITS) this.doValidatePIN = true;\n  }\n\n  goBack() {\n    this.nav.pop();\n    localStorage.clear();\n  }\n  // translate(string_key) {\n  //     let s = this.translator.get(string_key);\n  //     return s;\n  // }\n  // translateClean(string_key) {\n  //     let s = this.translator.getInnerHTML(string_key);\n  //     return s;\n  // }\n  showWelcomeAlert() {\n    let alert = this.alertCtrl.create({\n      title: this.translator.getInnerHTML('VERIFY_CODE_ALERT_TITLE') || 'Verification Code',\n      message: this.translator.get('VERIFY_CODE_ALERT_MESSAGE') || 'Enter your Verification Code',\n      cssClass: 'code-alert',\n      buttons: [\n        {\n          text: this.translator.getInnerHTML('POPUP_OK') || 'OK',\n          handler: data => {\n          }\n        }\n      ]\n    });\n    alert.present();\n  }\n}\n"]}